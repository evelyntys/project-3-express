{{#extends 'base'}}
{{#block 'content'}}
<h4>product listings:</h4>
<table class="table table-bordered border-dark">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Cost ($)</th>
            <th>Height (mm)</th>
            <th>Figure Type</th>
            <th>Collection</th>
            <th>Manufacturer</th>
            <th>Series</th>
            <th>Lauched in market?</th>
            <th>Release date</th>
            <th>Quantity</th>
            <th>Listing date (last updated)</th>
            <th>Controls</th>
        </tr>
    </thead>
    <tbody>
        {{#each figures}}
        <tr>
            <td>{{this.id}}</td>
            <td>{{this.name}}</td>
            <td>{{this.cost}}</td>
            <td>{{this.height}}</td>
            <td>{{this.figure_type.figure_type}}</td>
            <td>{{this.collection.collection_name}}</td>
            <td>{{this.manufacturer.manufacturer_name}}</td>
            <td>
                {{this.series.series_name}}
                {{#each this.series.groupings}}
                {{this.group_name}}
                {{/each}}
            </td>
            <td>
                {{#if this.launch_status}}
                yes
                {{else}}
                no
                {{/if}}
            </td>
            <td>{{this.release_date}}</td>
            <td>{{this.quantity}}</td>
            <td>{{this.listing_date}}</td>
            <td>
                <a href="/products/{{this.id}}/update" class="btn btn-primary my-1">update</a>
                <a href="/products/{{this.id}}/delete" class="btn btn-danger my-1 delete-btn"
                    data-figure-id="{{this.id}}" data-figure-name="{{this.name}}">delete</a>
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>
{{/block}}

{{#block 'js'}}
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    let deleteBtns = document.querySelectorAll('.delete-btn');
    for (let each of deleteBtns) {
        each.addEventListener('click', async function (e) {
            e.preventDefault();
            const result = await Swal.fire({
                title: `Delete listing for ${e.target.dataset.figureName}?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Confirm delete'
            }).then((result) => {
                if (result.isConfirmed) {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = `/products/${e.target.dataset.figureId}/delete`;
                    document.querySelector('body').appendChild(form);
                    form.submit();
                    Swal.fire(
                        'Deleted!',
                        'Listing successfully deleted',
                        'success'
                    )
                }
            })
        })
    }
</script>
{{/block}}
{{/extends}}